<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirma Sua Presença - Aniversário Marcell Moraes</title>
    <link rel="stylesheet" href="./assets/css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="form-container">

            <h1 style="color: #614112; font-size: 32px; margin-bottom: 0px;">Você Está Entre os</h1>
            <h1 style="font-size: 38px;">80 Escolhidos!</h1>

            <p>
                Você está entre as 80 pessoas que eu mais gosto e, <br>
                por isso, é meu convidado especial para celebrar <br>
                comigo essa data única!
            </p>

            <div class="event-details">
                <p><i class="fas fa-calendar-alt"></i> <strong>Data e Hora:</strong> Domingo, 31 de Agosto, às 15h</p>
                <p><i class="fas fa-map-marker-alt"></i> <strong>Local:</strong> Porto Trapiche Residence</p>
            </div>

            <h1
                style="margin-bottom: 20px; background-color: #614112; font-size: 16px; padding: 10px; border-radius: 8px; color: #f4d37f;">
                COM UM CANTOR CONHECIDO NACIONALMENTE</h1>

            <p>
                Este será um aniversário totalmente diferente, <br>
                preparado com muito carinho e pensado para <br>
                proporcionar momentos inesquecíveis.
            </p>

            <form id="formulario">
                <div id="formularioDiv">
                    <h4 for="nome" style="margin-top: 8px;">Seu Nome Completo:</h4>
                    <input type="text" id="nome" name="nome" placeholder="Digite seu nome" required>

                    <h4>
                        Ajude os animais da ONG GEAMO adiquirindo uma as opções de presente abaixo:
                    </h4>

                    <!-- Gift Options Grid -->
                    <div class="gift-options">
                        <div class="gift-option" data-value="100">
                            <img src="https://www.indrel.com.br/wp-content/uploads/2023/04/geladeira-de-vacinas-pet-scaled.jpg"
                                alt="Vacina para Cachorros">
                            <h5>Vacina para Cachorros</h5>
                        </div>
                        <div class="gift-option" data-value="1000">
                            <img src="https://www.indrel.com.br/wp-content/uploads/2023/04/geladeira-de-vacinas-pet-scaled.jpg"
                                alt="Vacina para Cachorros">
                            <h5>10 Vacinas para Cachorros</h5>
                        </div>
                        <div class="gift-option" data-value="500">
                            <img src="https://www.petz.com.br/blog/wp-content/uploads/2019/06/racao-canina.jpg"
                                alt="10 Sacos de Ração">
                            <h5>5 Sacos de Ração</h5>
                        </div>
                        <div class="gift-option" data-value="1000">
                            <img src="https://www.petz.com.br/blog/wp-content/uploads/2019/06/racao-canina.jpg"
                                alt="10 Sacos de Ração">
                            <h5>10 Sacos de Ração</h5>
                        </div>
                        <div class="gift-option" data-value="2000">
                            <img src="https://www.petz.com.br/blog/wp-content/uploads/2019/06/racao-canina.jpg"
                                alt="10 Sacos de Ração">
                            <h5>20 Sacos de Ração</h5>
                        </div>
                        <div class="gift-option" data-value="5000">
                            <img src="https://www.petz.com.br/blog/wp-content/uploads/2019/06/racao-canina.jpg"
                                alt="10 Sacos de Ração">
                            <h5>50 Sacos de Ração</h5>
                        </div>
                        <div class="gift-option" data-value="10000">
                            <img src="https://www.petz.com.br/blog/wp-content/uploads/2019/06/racao-canina.jpg"
                                alt="10 Sacos de Ração">
                            <h5>1 Tonelada de Ração</h5>
                        </div>
                        <div class="gift-option" data-value="35000">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTjkN_Q4ivumjhL-Idw6vVS_evQKDu8-sWi1R-RKPjxzOEuf9hoCU4ZADE_3YGV_Kp43kI&usqp=CAU"
                                alt="Samu Veterinário">
                            <h5>Samu Veterinário</h5>
                        </div>
                    </div>

                    <div
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; margin-top: 28px; margin-bottom: 16px;">
                        <div style="margin-top: 8px;" id="qrcode">Selecione alguma das opções <br>ou digite um valor
                            abaixo</div>
                        <div id="valor" class="valor"></div>
                        <button type="button" id="copiar-link"
                            style="display: none; background-color: #e7e7e7; color: black; margin-top: 15px;">
                            <i class="fa-solid fa-copy"></i> Copiar Link para o Pix
                        </button>
                    </div>

                    <h4>Ou, escolha o valor que você deseja doar, <br>preencha a baixo e clique em gerar PIX:</h4>
                    <p style="text-align: center;">Juntos podemos fazer a diferença! <br>Escolha o valor que o seu
                        coração
                        mandar.</p>
                    <input type="number" id="donation-amount" placeholder="Digite o valor em R$"
                        style="width: 100%; padding: 10px; margin-bottom: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <button type="button" id="generate-pix"
                        style="width: 100%; padding: 10px; background-color: #f4d37f; border: none; border-radius: 5px; color: #614112; font-size: 16px; margin-bottom: 8px;">
                        <i class="fa-brands fa-pix"></i> Gerar Pix</button>

                </div>
                <button style="margin-top: 16px;" type="submit" id="confirmar-btn" disabled><i
                        class="fa-solid fa-calendar-check"></i> Confirmar
                    Presença</button>
            </form>

        </div>
    </div>

    <!-- Módulo com Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCPJhR9HJhVkvFFk9IjitLGfxJ2bvGgBiY",
            authDomain: "aniversario-marcell-moraes.firebaseapp.com",
            projectId: "aniversario-marcell-moraes",
            storageBucket: "aniversario-marcell-moraes.firebasestorage.app",
            messagingSenderId: "759578737563",
            appId: "1:759578737563:web:9ca99e13ab16b9de163f3e"
        };

        // Inicializando o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variáveis de elementos
        const formulario = document.getElementById('formulario');
        const nomeInput = document.getElementById('nome');
        const opcaoSelect = document.getElementById('opcao');
        const valorDiv = document.getElementById('valor');
        const qrcodeDiv = document.getElementById('qrcode');
        const copiarBtn = document.getElementById('copiar-link');
        const confirmarBtn = document.getElementById('confirmar-btn');

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
            }).format(value);
        }

        // Gift option selection and Pix generation
        document.querySelectorAll('.gift-option').forEach(option => {
            option.addEventListener('click', function () {
                // Remove 'selected' class from all options
                document.querySelectorAll('.gift-option').forEach(opt => opt.classList.remove('selected'));

                // Add 'selected' class to clicked option
                option.classList.add('selected');

                // Get the value for the selected gift option
                const giftValue = option.getAttribute('data-value');
                document.getElementById('valor').textContent = `Valor: ${formatCurrency(giftValue)}`;

                // Deselect donation input if any gift option is selected
                document.getElementById('donation-amount').value = '';
                // Disable donation button if selecting a gift
                document.getElementById('generate-pix').disabled = false;

                // Hide the "Copiar Link" button
                document.getElementById('copiar-link').style.display = 'none';

                // Generate QR Code based on selected gift value
                document.getElementById('qrcode').innerHTML = 'Gerando QR Code...';
                generatePix(giftValue);
            });
        });

        // Donation button click event
        document.getElementById('generate-pix').addEventListener('click', function () {
            const donationAmount = document.getElementById('donation-amount').value;
            const selectedValue = document.querySelector('.gift-option.selected')?.getAttribute('data-value');
            const valueToGenerate = donationAmount || selectedValue;

            if (valueToGenerate) {
                // Show loading message
                document.getElementById('qrcode').innerHTML = 'Gerando QR Code...';

                // Simulate delay for loading
                setTimeout(function () {
                    generatePix(valueToGenerate);
                }, 1000); // Simulated delay
            } else {
                alert("Por favor, insira um valor para a doação ou selecione uma opção.");
            }
        });

        // Function to generate QR Code for Pix
        function generatePix(value) {
            const chavePix = '71985063857';
            const identificadorComerciante = 'AniversarioMarcell';
            const descricaoTransacao = 'DoacaoAnimais';

            const pixCode = `00020126360014BR.GOV.BCB.PIX0136${chavePix}52040000530398654041${value}5802BR5925${identificadorComerciante}6009${descricaoTransacao}6304someQRCodeHash`;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(pixCode)}&size=150x150`;

            // Display QR Code
            document.getElementById('qrcode').innerHTML = `<img src="${qrCodeUrl}" alt="QR Code Pix">`;
            document.getElementById('valor').textContent = `Valor: ${formatCurrency(value)}`;

            // Show the "Copy Link" button
            document.getElementById('copiar-link').style.display = 'inline-block';

            // Enable the Confirm button
            document.getElementById('confirmar-btn').disabled = false;
        }

        // Copy Pix link to clipboard
        document.getElementById('copiar-link').addEventListener('click', function () {
            const pixCode = document.getElementById('copiar-link').getAttribute('data-clipboard-text');
            navigator.clipboard.writeText(pixCode).then(() => {
                alert("Link do Pix copiado com sucesso!");
            }).catch((err) => {
                console.error("Erro ao copiar o link: ", err);
            });
        });


        formulario.addEventListener('submit', function (e) {
            e.preventDefault();

            const nome = nomeInput.value;

            // Obtém o valor da doação (se digitado no input) ou da opção selecionada
            let valor = document.getElementById('donation-amount').value; // Valor do input
            if (!valor) {
                // Se não houver valor no input, pega o valor da opção selecionada
                valor = document.querySelector('.gift-option.selected')?.getAttribute('data-value');
            }

            // Se não houver valor (nenhum presente selecionado e o input estiver vazio), exibe um erro
            if (!valor) {
                alert("Por favor, insira um valor para a doação ou selecione uma opção.");
                return;
            }

            // Caso tenha vindo do input, converte o valor para um número válido
            if (valor === document.getElementById('donation-amount').value) {
                valor = parseFloat(valor.replace(",", "."));
            }

            // Verifica se o valor é válido
            if (isNaN(valor) || valor <= 0) {
                alert("Por favor, insira um valor válido.");
                return;
            }

            // Usando o método addDoc para adicionar um novo documento na coleção
            addDoc(collection(db, 'confirmados'), {
                nome: nome,
                valor: valor, // Envia o valor para o Firestore
                timestamp: serverTimestamp()
            })
                .then(() => {
                    alert('Sua presença foi confirmada! Obrigado pelo presente.');
                    nomeInput.value = ''; // Limpa o campo
                    document.getElementById('valor').textContent = ''; // Limpa o valor exibido
                    document.getElementById('donation-amount').value = ''; // Limpa o input de doação
                    document.querySelectorAll('.gift-option').forEach(option => option.classList.remove('selected')); // Desmarca a seleção
                })
                .catch((error) => {
                    console.error('Erro ao salvar os dados: ', error);
                    alert('Ocorreu um erro. Tente novamente.');
                });
        });

    </script>
</body>

</html>